# Тестовое задание на вакансию Стажёр в команду ленты и потребления контента

## Задание

> Необходимо написать API для сервиса, представляющего собой справочник
> телефонных номеров с отзывами.
> Что надо уметь:
> 1. Пользователь вводит телефонный номер и получает название страны,
> которой принадлежит данный номер телефона.
> Телефон является международным, если начинается с символа `+`.
> Формат ввода телефона пользователем может быть любым.
> Если телефон не международный, то считаем, что номер российский.
> Возможные коды стран (считаем, что будут только такие):
>   + `+7` - "RU" (Россия)
>   + `+1` - "US" (США)
>   + `+86` - "CH" (Китай)
>   + `+52` - "MX" (Мексика)
>   + `+1905` - "MX" (ещё один код для Мексики)
> 
> 2. Пользователь может оставить отзыв о номере телефона, который он ввёл.
> Отзыв - текстовое поле произвольной длины.
> 
> 3. Пользователь может посмотреть отзывы о введённом номере телефоне,
> если они есть в нашем сервисе. Возвращаем список отзывов.
> 
> 4. Пользователь может быть как авторизованным, так и анонимным.
> Писать регистрацию и авторизацию не надо. Если показываем отзыв,
> оставленный авторизованным пользователем, то надо отобразить его имя,
> иначе писать "анонимно".
> 
> 5. Пользователь может искать телефоны в нашем сервисе по их началу.
> Необходимо вернуть список найденных телефонов и количество отзывов о них.
> 
> 6. Каждый отзыв может иметь рейтинг, который могут понизить или повысить
> только авторизованные пользователи. Этот рейтинг необходимо показывать везде,
> где мы отображаем отзыв.
> 
> 7. Продумать и решить проблемы, которые могут возникнуть в случае высоких нагрузок
> на наши методы.
> 
> 8. Также стоит подумать над обработкой ошибок.
> 
> Задача должна быть написана на PHP, без использования фреймворков.
> Необходимо оформить код в ООП стиле.
> Как и где хранить данные - решаете сами.

## Описание ресурсов API

### Любой ресурс

В общем случае ответ на любой запрос представляет собой JSON-объект со следующими полями:
- `error`: выставляется в `true` в случае какой-либо ошибки (запроса или ответа) или `false` в противном случае
- `description` (опционально): в случае ошибки содержит её примерное описание (неверные данные,
не передан параметр) и отсутствует в противном случае
- `result` (опционально): в случае успешно обработанного запроса содержит его результат (сгенерированный ответ)

Также статус ответа передаётся в коде ответа HTTP.

### `GET phone/country_code`

Получить код страны для переданного номера телефона. Формат номера телефона допускает произвольное количество
символов разделителей (открывающие/закрывающие скобки, пробелы и дефисы). Номер телефона является международным,
если начинается с символа `+`. Код страны определяется, если номер телефона международный.
В противном случае считается, что переданный номер российский.

Сервис поддерживает определение следующих стран по начальным символам номера телефона:
+ `+7` - `RU` (Россия)
+ `+1` - `US` (США)
+ `+86` - `CH` (Китай)
+ `+52` - `MX` (Мексика)
+ `+1905` - `MX` (ещё один код для Мексики)

#### Формат запроса
```
GET index.php/phone/country_code?phone_number=<номер телефона>
```

#### Формат ответа
```
HTTP/1.1 200 OK
Content-Type: application/json

{
  "error": false, 
  "result": {
    "phone_number": <номер телефона>,
    "country_code": "<код страны>"
  }
}
```

### `POST review/submit_review`

Оставить отзыв о введённом номере телефона. Отзыв представляет собой текстовое поле произвольной длины.
Пользователь может быть как авторизованным, так и анонимным.
В данном проекте полноценная авторизация и аутентификация **НЕ РЕАЛИЗОВАНЫ**.
В качестве средства определения имени пользователя используется поле тела запроса в виде JSON.
Если имя пользователя не указано, отзыв будет оставлен анонимно.

#### Формат запроса
```
GET index.php/review/submit_review?phone_number=<номер телефона>
Content-Type: application/json

{
  "review_text": "<текст отзыва>",
  "username": "<имя пользователя>"
}
```

#### Формат ответа
```
HTTP/1.1 201 Created
Content-Type: application/json

{
  "error": false,
  "result": {
    "phone_number": "<номер телефона>",
    "submitted_review": "<текст полученного отзыва>"
  }
}
```

### `GET review/list_reviews`

Получить список отзывов о введённом номере телефона.
Если номер не может быть найден в сервисе, возвращается пустой список.

#### Формат запроса
```
GET index.php/review/list_reviews?phone_number=<номер телефона>
```

#### Формат ответа
```
HTTP/1.1 200 OK
Content-Type: application/json

{
  "error": false,
  "result": {
    "phone_number": "<номер телефона>",
    "reviews": [
      {
        "id": "<ID отзыва>",
        "body": "<текст отзыва>",
        "author": "<автор отзыва>",
        "rating": "<рейтинг отзыва>"
      },
      ...
    ]
  }
}
```

### `GET phone/search_phones`

Получить список номеров телефона, найденных по шаблону. Выполняется поиск номеров,
начинающихся с переданного значения. Для каждого найденного по шаблону номера указывается количество отзывов о нём.

#### Формат запроса
```
GET index.php/phone/search_phones?phone_pattern=<шаблон поиска>
```

#### Формат ответа
```
HTTP/1.1 200 OK
Content-Type: application/json

{
  "error": false,
  "result": {
    "phone_pattern": "<шаблон поиска>",
    "matches": [
      {
        "phone_number": "<найденный по шаблону номер телефона>",
        "reviews_count": <количество отзывов для найденного номера телефона>
      },
      ...
    ]
  }
}
```

### `POST review/{upvote,downvote}`

Изменение (повышение или понижение) рейтинга отзыва на номер телефона.
Позволяет изменить значение рейтинга какого-либо отзыва,
выбранного по его ID (может быть получен, например, при поиске отзывов для определённого номера телефона).
Для повышения рейтинга (увеличения значения на 1) ресурс вызывается со строкой `upvote`,
а для понижения (уменьшения значения на 1) — со строкой `downvote`.
К данному ресурсу возможно обращение только авторизованных пользователей (см. выше).
Для успешно изменённого рейтинга отзыва возвращается его актуальная копия (с обновлённым рейтингом).

#### Формат запроса
```
POST index.php/review/upvote?review_id=<id отзыва>
Content-Type: application/json

{
  "username": <имя пользователя>
}
```

#### Формат ответа
```
POST /index.php/review/upvote?review_id=<id отзыва>

HTTP/1.1 200 OK
Content-Type: application/json

{
  "error": false,
  "result": {
    "updated_review": {
      "id": "<id отзыва>",
      "num_id": "<id номера, для которого оставлен отзыв>",
      "body": "<текст отзыва>",
      "author": "<автор отзыва>",
      "rating": "<рейтинг отзыва>"
    }
  }
}
```

## Дополнительно

Основная структура проекта
взята с сайта [TutsPlus](https://code.tutsplus.com/tutorials/how-to-build-a-simple-rest-api-in-php--cms-37000).
Проект написан на чистом PHP (PHP 7.4 под Ubuntu 20.04 LTS), без использования фреймворков и сторонних библиотек.
